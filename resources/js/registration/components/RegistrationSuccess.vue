<template>
  <div 
    class="relative mx-auto my-0 w-[375px] max-md:w-full max-md:max-w-screen-md max-sm:w-full overflow-hidden flex flex-col"
    :style="{ 
      minHeight: '100dvh',
      backgroundImage: `url(${backgroundImage})`, 
      backgroundSize: '100% 100%', 
      backgroundPosition: 'center center', 
      backgroundRepeat: 'no-repeat'
    }"
  >
    <!-- é ‚éƒ¨æ¨™é¡Œ -->
    <div class="relative z-10 pb-8 px-6" style="padding-top: max(3rem, env(safe-area-inset-top, 0px) + 1rem);">
      <img 
        :src="headerImage" 
        alt="ä¸‰ç«‹å…«é»å°åŠ‡ã€Šç™¾å‘³äººç”Ÿã€‹ç²‰çµ²è¦‹é¢æœƒ" 
        class="w-full max-w-[360px] mx-auto"
      />
    </div>

    <!-- ä¸»è¦å…§å®¹å¡ç‰‡ -->
    <div class="relative z-10 px-4 pb-8">
      <!-- ç™½è‰²å¡ç‰‡å®¹å™¨ï¼ˆå’Œæ­¡è¿é ä¸€æ¨£çš„çµæ§‹ï¼‰ -->
      <div class="bg-white rounded-xl shadow-2xl overflow-hidden max-w-[360px] mx-auto p-2">
        <!-- æµ·å ±åœ–ç‰‡ + é®ç½© -->
        <div class="relative rounded-xl overflow-hidden" 
             :style="{ 
               backgroundImage: `url(${posterImage})`, 
               backgroundSize: 'cover', 
               backgroundPosition: 'center' 
             }">
          
          <!-- åŠé€æ˜é»‘è‰²é®ç½© + æ–‡å­—å…§å®¹ -->
          <div class="bg-black bg-opacity-75 flex items-center justify-center py-8 px-6">
            <!-- å ±åæˆåŠŸå…§å®¹ -->
            <div v-if="!isFull" class="text-white text-center">
              <h2 class="text-sm font-bold mb-2">{{ userName }}ï¼Œæ‚¨å¥½</h2>
              <p class="text-sm leading-relaxed mb-4">
                æ‚¨å·²æˆåŠŸå ±åã€Šç™¾å‘³äººç”Ÿã€‹<br>
                ç²‰çµ²è¦‹é¢æœƒæ—©é³¥å¥½åº·æ´»å‹•ï¼
              </p>
              <div class="text-sm leading-relaxed">
                <p class="font-semibold text-base"><span style="color: #FFF001; text-underline-offset: 3px;">ã€Šé™é‡å¥½ç¦®å…Œæ›æ–¹å¼ã€‹</span></p>
                <div class="inline-block text-left">
                  <p class="mb-1">
                    1. ç²‰çµ²è¦‹é¢æœƒå‰å°‡ç™¼é€ç²‰çµ²æ´»å‹•é€šè¡Œè­‰çµ¦æ‚¨
                  </p>
                  <p class="font-semibold">
                    2. è«‹æ–¼<span style="color: #FFF001; text-decoration: underline wavy; text-underline-offset: 3px;">æ´»å‹•ç•¶å¤©11:00~16:00æ–¼ã€æ—©é³¥å¥½åº·æ´»å‹•å…Œæ›è™•ã€‘</span><span style="color: #FFF001; text-decoration: underline wavy; text-underline-offset: 3px;">å‡ºç¤ºå®˜æ–¹LINEå…§é€šè¡Œè­‰å³å¯å…Œæ›é™é‡å¥½ç¦®</span>
                  </p>
                </div>
              </div>
            </div>

            <!-- é¡æ»¿å…§å®¹ -->
            <div v-else class="text-white text-center">
              <h2 class="text-xl font-bold mb-4">æ—©é³¥å¥½åº·æ´»å‹•åé¡ å·²é¡æ»¿</h2>

              <div class="text-sm leading-relaxed">
                <p class="font-bold">
                    ç•¶å¤©ä»æ­¡è¿æ‚¨è‡³ã€Šç™¾å‘³äººç”Ÿã€‹ç²‰çµ²è¦‹é¢æœƒ
                  </p>
                  <p class="font-bold">
                  ç¾å ´èˆ‡æ¼”å“¡åŒæ¨‚<br>
                  æ›´å¤šå¥½åº·æŠ½çæ´»å‹•<br>
                  è«‹ä¸Šä¸‰ç«‹å°åŠ‡å®˜æ–¹ç²‰çµ²å°ˆé æŸ¥è©¢<br>
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- æ´»å‹•è³‡è¨Š -->
        <div class="pt-4 pb-2">
          <div class="text-sm font-bold text-gray-900 space-y-1">
            <p>æ´»å‹•æ™‚é–“ï¼š2026/2/7(å…­) 13:30</p>
            <p>
              æ´»å‹•åœ°é»ï¼š
              <a 
                href="https://www.google.com/maps/search/?api=1&query=å°åŒ—å¸‚è¿ªåŒ–è¡—å¤§ç¨»åŸ•æˆ²è‹‘å‰å»£å ´"
                target="_blank"
                class="text-blue-600 underline hover:text-blue-800 transition-colors font-bold"
              >
                ğŸ“ å°åŒ—å¸‚è¿ªåŒ–è¡—å¤§ç¨»åŸ•æˆ²è‹‘å‰å»£å ´
              </a>
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- é—œé–‰æŒ‰éˆ• -->
    <div class="relative z-10 px-4" style="padding-bottom: max(3rem, env(safe-area-inset-bottom, 0px) + 1rem);">
      <button
        @click="handleClose"
        class="w-full max-w-[360px] mx-auto block py-5 text-white text-xl font-bold rounded-full shadow-xl transition-all duration-300 hover:scale-105 active:scale-95"
        style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);"
      >
        é—œé–‰
      </button>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'
import backgroundImg from '@assets/images/background.png'
import headerImg from '@assets/images/header.png'
import posterImg from '@assets/images/MainImage.png'

const props = defineProps({
  registration: {
    type: Object,
    default: null
  },
  userName: {
    type: String,
    default: 'ç‹å¤§ç¾'
  },
  isFull: {
    type: Boolean,
    default: false
  }
})

const emit = defineEmits(['close'])

const backgroundImage = ref(backgroundImg)
const headerImage = ref(headerImg)
const posterImage = ref(posterImg)

function handleClose() {
  // LIFF ç’°å¢ƒï¼šé—œé–‰ LIFF è¦–çª—
  if (typeof liff !== 'undefined' && liff.isInClient()) {
    liff.closeWindow()
    return
  }
  
  // PC ç‰ˆï¼šå˜—è©¦é—œé–‰è¦–çª—
  // window.close() åªæœ‰åœ¨è¦–çª—æ˜¯ç”± JavaScript æ‰“é–‹æ™‚æ‰èƒ½é—œé–‰
  // å¦‚æœè¦–çª—æ˜¯ç”¨æˆ¶ç›´æ¥æ‰“é–‹çš„ï¼Œwindow.close() ä¸æœƒå·¥ä½œï¼ˆç€è¦½å™¨å®‰å…¨é™åˆ¶ï¼‰
  
  // å¦‚æœå·²å ±åæˆåŠŸï¼Œå˜—è©¦é—œé–‰è¦–çª—ï¼›å¦‚æœç„¡æ³•é—œé–‰ï¼Œä¿æŒåœ¨æˆåŠŸé é¢
  if (props.registration || props.isFull) {
    // æª¢æŸ¥è¦–çª—æ˜¯å¦å¯ä»¥é—œé–‰
    // window.opener å­˜åœ¨è¡¨ç¤ºè¦–çª—æ˜¯ç”± JavaScript æ‰“é–‹çš„
    if (window.opener) {
      try {
        window.close()
        // å¦‚æœé—œé–‰æˆåŠŸï¼Œè¦–çª—æœƒé—œé–‰ï¼Œä¸æœƒåŸ·è¡Œå¾ŒçºŒä»£ç¢¼
        return
      } catch (error) {
        // é—œé–‰å¤±æ•—ï¼Œä¿æŒåœ¨æˆåŠŸé é¢
        alert('å ±åå·²å®Œæˆï¼æ‚¨å¯ä»¥æ‰‹å‹•é—œé–‰æ­¤è¦–çª—ã€‚')
        return
      }
    } else {
      // è¦–çª—ä¸æ˜¯ç”± JavaScript æ‰“é–‹çš„ï¼Œç„¡æ³•é—œé–‰
      // ä¿æŒåœ¨æˆåŠŸé é¢ï¼Œä¸ emit('close')
      alert('å ±åå·²å®Œæˆï¼æ‚¨å¯ä»¥æ‰‹å‹•é—œé–‰æ­¤è¦–çª—ã€‚')
      return
    }
  }
  
  // åªæœ‰åœ¨æœªå ±åæˆåŠŸçš„æƒ…æ³ä¸‹ï¼ˆä¾‹å¦‚å…¶ä»–æƒ…æ³ï¼‰ï¼Œæ‰ emit('close')
  emit('close')
}
</script>

<style scoped>
/* ç¢ºä¿åœ¨æ‰‹æ©Ÿä¸Šæ­£ç¢ºé¡¯ç¤º */
@media (max-width: 375px) {
  .max-w-\[340px\] {
    max-width: calc(100vw - 3rem);
  }
}
</style>
